#!/bin/bash
########## Define Resources Needed with SBATCH Lines ##########

#SBATCH --time=24:00:00          # limit of wall clock time - how long the job will run (same as -t)
#SBATCH --array=1-10
#SBATCH --mem=8G       # memory required per node - amount of memory (in bytes)
#SBATCH --job-name test_job         # you can give your job a name for easier identification (same as -J)


########## Command Lines to Run ##########

JOB_SEED_OFFSET=2000
RUN_ID=$((SLURM_ARRAY_TASK_ID - 1))
SEED=$((JOB_SEED_OFFSET + RUN_ID))

# Variables for convenience

EXP_NAME="2025-10-07-test-work-flow"
EXEC="symbulation_sgp"
REPO_DIR=/mnt/home/hillaryo/repo_ws/2025-fall-gvsu-symbiosis-mechanisms # Project should be replaced with the actual project name
CONFIG_DIR=${REPO_DIR}/experiments/${EXP_NAME}/hpc/config
RUN_DIR=/mnt/scratch/lalejina_scratch/hillaryo/${EXP_NAME}/RUN_${SEED}


# Load correct environment variables, modules, etc.
source ${REPO_DIR}/setup.sh
mkdir -p ${RUN_DIR}
cd ${RUN_DIR}
cp ${CONFIG_DIR}/${EXEC} .
cp ${CONFIG_DIR}/*.json .
cp ${CONFIG_DIR}/*.cfg . 

./${EXEC} -SEED ${SEED} -ENABLE_NUTRIENT 1 -NUTRIENT_TYPE parasite -NUTRIENT_STEAL_PROP 0.20 -NUTRIENT_INTERACTION_MULTIPLIER 4 -PARASITE_BASE_TASK_VALUE_PROP 0.1 -HOST_AGE_MAX -1 -HOST_REPRO_RES 20 -SYM_HORIZ_TRANS_RES 20 -HOST_MIN_CYCLES_BEFORE_REPRO 200 -SYM_MIN_CYCLES_BEFORE_REPRO 100 > run.log

# Clean up run directory
rm ${RUN_DIR}/*.cfg
rm ${RUN_DIR}/${EXEC}